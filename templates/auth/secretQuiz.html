<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1"></script> <!-- Конфеті -->
</head>
<body>
    <div class="container">
        {% if latest_question %}
            <h2 id="question-text">{{ latest_question.question_text }}</h2>

            <ul>
                {% for choice in choices %}
                    <li>
                        <button class="answer-btn" data-choice-id="{{ choice.id }}">{{ choice.choice_text }}</button>
                    </li>
                {% endfor %}
            </ul>

        {% else %}

        <button type="submit" form="quiz-form">Next</button>

        {% if not question %}
            <h2>Quiz Finished!</h2>
            <a href="{% url 'quiz_result' %}">View Results</a>
        {% endif %}
        {% endif %}
    </div>

    <script>
        document.querySelectorAll('.answer-btn').forEach(button => {
            button.addEventListener('click', function() {
                let choiceId = this.dataset.choiceId;
                let btn = this;

                fetch('/check_answer/', {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": getCookie("csrftoken")  // CSRF-токен для Django
                    },
                    body: "choice_id=" + choiceId
                })
                .then(response => response.json())
                .then(data => {
                    if (data.correct) {
                        confettiEffect();
                        setTimeout(() => {
                            // Завантажуємо наступне питання
                            window.location.reload();
                        }, 2000);
                    } else {
                        wrongAnswerEffect(btn);
                    }
                });
            });
        });

        function confettiEffect() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function wrongAnswerEffect(button) {
            button.style.backgroundColor = "red";  // Миготіння червоним
            button.style.animation = "shake 0.3s";  // Вібрація
            setTimeout(() => {
                button.style.backgroundColor = "";
                button.style.animation = "";
            }, 300);
        }

        function getCookie(name) {  // Функція для отримання CSRF-токена
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                let cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>

    <style>
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</body>
</html>
